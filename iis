####Simple config information for IIS#########################


##If you deploy a new .NET app you will need to add the app pool user to the security of the folder

##deploy an app called dnn the app pool identity will be called 'dnn' unless you change it

##right click on the folder select the security tab and give IIS AppPool\dnn at least modify rights to the folder
###Make certain you are pointing to the local machine if you are on a domain joined system with the above command

###Or ICACLS
ICACLS d:\web\dnn /grant "IIS AppPool\dnn":F /t(for recursive)

##This is the 'Name' under application pools

####When installing the Web-WebServer Role I had issues with IIS, so I just installed the Web-Server role and everything was okay######


#####STEP BY STEP############################
#Add data drive to server this is going to be where all apps are located
##Create a folder and remove inheritance
##Create sub-folders for each app
##Create a new site in IIS
##Add the IIS AppPool user to the folder i.e. "IIS AppPool\AppA
##*VERY IMPORTANT IF THE SERVER IS PART OF A DOMAIN THEN THE "WINDOWS AUTHENTICATION" IIS FEATURE MUST BE INSTALLED
##AND ENABLED FOR THIS TO WORK
##Test App


###### CHECK WHICH ACCOUNT ANONYMOUS USERS ARE USING TO CONNECT TO YOUR WEBSERVER###########
##Under IIS Manager click on your site/app then click on "Authentication" from there make certain
###Anonymous is set to 'enabled" and then double click to see what user account is being used
###Then make certain that user account has read rights to the above folder, or in my case
##One level above all my app folders


########MAKE CERTAIN THAT IF THE WINDOWS FIREWALL IS ON YOU ARE ALLOWING THE PORTS YOU NEED!!###########



########STEPS TO SETUP NEW IIS SERVER FOR DEV-QA AND PROD @ for .NET APPS#########################

1. DBA has to grant access to the new server to the affected Databases

2. IIS has to be installed on the target server (build an ansible playbook to set this up)

3. Install Feature Windows Process Activation Service and select all sub-features(again use an ansible playbook for this)

4. Create a folder to host all .NET apps remove inherited permissions and assign appropriate rights to developers and 

5. Make certain app pool identity user has modify/fullcontrol of app folder with above examples

6. Check the app to see what user(usually:IUSR) is being used for anonymous conections and give that user read permission to the app folder or 
   give that user read to the root folder so rights will automatically flow down to all apps as they are provisioned (Test this if this is in a domain you might not have to assign the
   IUSR read rights to the folder - An IIS expert would better be able to answer this one)
   
7. Make certain Windows Authentication is enabled(Note if you set this at the root of the IIS server all apps will inherit this setting and there would be one less thing to remember
   for each app deployed









###############PERMISSION ISSUES######################################################################
##Again I had massive issues with permissions when I added a second drive and added my apps under it
##This time for some reason on first launch it generated a webconfig file and then when I attempted to 
###Add permissions after the webconfig was generated it gave me permission errors, I had to explicitly
##Assign rights to the webconfif file and everything started to work--Ironically I deleted the webconfig
##file and it never regenerated, which is fine because I don't need it I was building an api server



###What I have noticed is that you need to add your permissions first and then run the app
###Also at the root I added both the IUSR and IIS_IUSRS with read permissions


###Great artcle on creating URL rewrite for http to https
##REF:https://www.namecheap.com/support/knowledgebase/article.aspx/9953/38/setting-up-an-httphttps-redirect-in-iis







