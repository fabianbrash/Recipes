#Various Powershell commands for installing and configuring a Server core and Server GUI install


#Configure Server core
sconfig

#Powershell AD Join commands 
 
#Check available commands 
Get-command –module ADDSDeployment 
 
#Run Poweshell against remote servers 
invoke-command {install-addsdomaincontroller –domainname ethernuno.intra –credential (get-credential) –computername dc02 
 
#Simplest way of Creating a new Forest 
Install-ADDSForest –DomainName "lab.net" 
 
#Customized Configuration  
Install-ADDSForest –DomainName ‘lab.net’ –CreateDNSDelegation –DomainMode Win2012R2 –ForestMode Win2012R2 –DatabasePath "d:\NTDS" –SYSVOLPath "d:\SYSVOL" –LogPath "e:\Logs"
Install-ADDSForest –DomainName $domain –DomainMode Win2012R2 –ForestMode Win2012R2 -Force -SafeModeAdministratorPassword (convertto-securestring $password -asplaintext -force) –DatabasePath $locationNTDS –SYSVOLPath $locationSYSVOL –LogPath $locationNTDSLogs -verbose

#First you MUST install AD Role on Server
Install-Windowsfeature AD-Domain-Services,DNS

#Join an existing Domain this is the replacment for DCPROMO
Install-ADDSDomainController -DomainName 'awssol.com' -InstallDNS:$True –Credential (Get-Credential) 

#CleanUp commands 
Get-help Uninstall-ADDSDomainController 
 
#Demote Commands 
Uninstall-ADDSDomainController –Forceremoval -Demoteoperationmasterrole 
 
#Set TrustedHost 
Set-Item WSMan:\localhost\Client\TrustedHosts -Value ‘hostname,hostname.local’ –Force 

#Get windows features
Get-Windowsfeature
#Install windows feature
Install-Windowsfeature -Name 'FeatureName' -IncludeAllSubFeature -IncludeManagementTools
Install-Windowsfeature -Name 'FeatureName','FeatureName'

#Disable FireWall You can also do this with a GPO Computer Config>Admin Templates>Network>Network Connections>Windows Firewall
#Advance Firewall settings GPO comouter config>Policies>Windows Swttings>Security Settings>Windows Firewall with Advanced Security
Set-NetFirewallProfile -Profile Domain,Public,Private -Enabled False

#In a virtual environment you will need configure an external time source for your PDC
w32tm.exe /config /manualpeerlist:"0.us.pool.ntp.org 1.us.pool.ntp.org" /syncfromflags:manual /reliable:YES /update
w32tm.exe /config /update
Restart-Service w32time

#Remote Volume Management
#VDS must be running on both the local and remote device, please make certain to open up 'Remote Volume Management' 

#Must register this on each DC so you can move Schema master role
regsvr32 schmmgmt.dll
#Then load mmc.exe and you should now see an options for schema master

