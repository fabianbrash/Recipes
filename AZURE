###Notes for deploying resources into AZURE, hopefully this will help me to take and pass the
##"Micosoft Azure Administrator AZ-103" 

#REF:https://docs.microsoft.com/en-us/azure/virtual-machines/windows/tutorial-manage-vm
##REF:https://docs.microsoft.com/en-us/powershell/module/azurerm.compute/?view=azurermps-6.13.0#vm_images

####BASIC DEPLOYMENT#######


##Create a ResourceGroup > Virtual Networks > Global Network > Subnets > Network Security Group(Under Network Interfaces) > Public IP > VM

#####I am using the Az moduels are they are build on .Net core and Powerrshell core and are cross-platform but there are
###Azure(old powershell modules), AzureRM(new modules), and then Az(newest modules based on .net core and PS core)

###Let's log into our Azure account######
LoginAzAccount

Get-AzVM ###If you have 1 resourcegroup this is fine

Get-AzVM -ResourceGroupName "Test"

###Also
Get-AzVM -Status

##Create a resource Group
New-AzResourceGroup -Name TestResourceGroup -Location centralus


####Let's delete a VM#####
Remove-AzVM -ResourceGroupName "Test" -Name "MYVM" -Confirm:$false -Force


###Let's logout####
Logout-AzAccount


###Get all our resources from a resource group

Get-AzResource -ResourceGroupName "Test" | ft


##Get network resources

Get-AzNetworkInterface

##Now let's remove a network interface
Remove-AzNetworkInterface -ResourceGroupName "Test" -Name WebServers -Confirm:$false -Force

##Get our security group(s)
Get-AzNetworkSecurityGroup

##Get our Virtual Network
Get-AzVirtualNetwork -ResourceGroupName "Test"


##Get all image publishers in the central region###
Get-AzVMImagePublisher -Location "CentralUS"

##From East US etc...
Get-AzVMImagePublisher -Location "EastUS"

##Get Image offer publisher name is required but you get that from the above command##
##Note for Microsoft they have a ton so look around####

Get-AzVMImageOffer -Location "CentralUS" -PublisherName MicrosoftWindowsServer 

###Now let's get our SKU#####

Get-AzVMImageSku -PublisherName MicrosoftWindowsServer -Location "centralus" -Offer WindowsServer


####Now we can deploy a VM with the below

$cred = Get-Credential

New-AzVm `
    -ResourceGroupName "myResourceGroupVM" `
    -Name "myVM2" `
    -Location "CentralUS" `
    -VirtualNetworkName "myVnet" `
    -SubnetName "mySubnet" `
    -SecurityGroupName "myNetworkSecurityGroup" `
    -PublicIpAddressName "myPublicIpAddress2" `
    -ImageName "MicrosoftWindowsServer:WindowsServer:2016-Datacenter-with-Containers:latest" `
    -Credential $cred `
    -AsJob


#####Create a new empty resource group and tag it######

New-AzResourceGroup -Name "Lab" -Location "eastus" -Tag @{Name="Lab"} 

$mgmtsubnet = New-AzVirtualNetworkSubnetConfig -Name "Jumphosts" -AddressPrefix "10.0.99.0/24"

$infrasubnet = New-AzVirtualNetworkSubnetConfig -Name "Infra" -AddressPrefix "10.0.40.0/24"

New-AzVirtualNetwork -Name "LabNetwork" -ResourceGroupName "Lab" -Location "eastus" -AddressPrefix "10.0.0.0/16" -Subnet $mgmtsubnet,$infrasubnet


##View public IP addresses

Get-AzPublicIpAddress -ResourceGroupName "Alexander" 

Get-AzPublicIpAddress -ResourceGroupName "Alexander" -Name *Web*


##View the IPprefix this only works if you have running VM's as they will have public IP's assigned

Get-AzPublicIpPrefix -ResourceGroupName "Alexander" -Name *Web*

Get-AzPublicIpPrefix -ResourceGroupName "Alexander"

##New public IP address
New-AzPublicIpAddress -ResourceGroupName "Lab" -Name "jumphost"  -Location "eastus" -IpAddressVersion "IPv4" -AllocationMethod Dynamic 


